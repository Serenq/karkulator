<!DOCTYPE html>
<html lang="ru">

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta charset="UTF-8">
    <title>Калькулятор 1.0</title>
    <!-- styles -->
    <link rel="stylesheet" href="style/main.css">
</head>

<body>
    <div class="container container-margins">
        <h1>Обновление 1.3</h1>
        <ul style="margin-bottom: 30px;">
            <li>Проверка ввода.</li>
            <li>Форматирование матемитического алгоритма, можно вставлять чепуху.</li>
            <li>Предварительный просмотр результата.</li>
            <li>Возможность не прирывать вычисление нажимая на математические операторы.</li>
            <li>После нажатия кнопки (=), можно продолжать вычисления.</li>
        </ul>

        <h2>Описание 1.3</h2>

        <p>Попытка перевести скрипты в классовый стиль. Попытка завершилась блестящим успехом! Так же были найдены недоработки в регулярках. Перевод в классовый стиль занял на удивление очень мало времени. Это успех! Немного пришлось повозиться с контекстом вызова событий. Есть контекст объекта, а есть и контекст хтмл-элементов которые вызвали события. Что бы не загаживать код, решением послужило у стрелочной функции через эвент обращаться к элементу вызвавшего событие. (event.currentTarget) - эта штука служила THIS'ом элемента.</p>

        <hr>

        <h1>Обновление 1.2</h1>
        <ul style="margin-bottom: 30px;">
            <li>Проверка ввода.</li>
            <li>Форматирование матемитического алгоритма, можно вставлять чепуху.</li>
            <li>Предварительный просмотр результата.</li>
            <li>Возможность не прирывать вычисление нажимая на математические операторы.</li>
            <li>После нажатия кнопки (=), можно продолжать вычисления.</li>
        </ul>

        <h2>Описание 1.2</h2>

        <p>Самый сложный вынос мозга уже позади. С любопытством занимаюсь марафетом интерфейса. За пресест с утра, удалось исправить все встретившиеся баги регулярок. В конце прикрутил реакцию цветовой темы на время суток, что бы в тёмное время не резало глаза.</p>
        
        <hr>

        <h1>Обновление 1.1</h1>
        <ul style="margin-bottom: 30px;">
            <li>ДОБАВЛЕНО: Автоформатирование вводимого</li>
            <li>ДОБАВЛЕНО: Возможность вводить длинные последовательности</li>
            <li>Проверка ввода.</li>
            <li>Предварительный просмотр результата</li>
            <li>После нажатия кнопки (=), обновляется ввод</li>
            <li>НЕЛЬЗЯ: Вводить скобки</li>
        </ul>

        <h2>Описание 1.1</h2>

        <p>Миновало 7 месяцев с тех пор как появился данный проект калькулятора. Время от времени Я не переставал размышлять о том как улучшить ввод данных. Предыдущая версия была ограничена двумя операндами. На днях мне пришла мысль - пойти другим путём проверки ввода. Вместа проверки вводимиого и запрещения ввода последовательности символов, наоборот - затирать ненужные символы. Например лишние плюсы (2++++2), лишние нули (0000.01), лишние точки в группе (11....22) или в теле операнда (11.222.333....44). Вполне себе жизнеспособная идея. В результате вышел не такой замороченный шаблон регулярного выражения. Но пришлось полазить, поискать информацию по реализации. Сложнее всего было узнать - как двигаться в обратном направлении в шаблоне выражения. Парадокс заключался в том, что на сайте по отладке регулярного выражения чётко написано - "движение назад не поддерживается в javascript". А оно вдруг берёт и поддерживается! И хорошо работает. Мне пришёл на помощь скобочный оператор "взгляд назад": <span class="code-fragment">(?<=)</span>.</p>
        
        <p>Ещё понадобилось игрнорирование первого символа <span class="code-fragment">\B</span>. Первого из последовательности (1+++++2). Первый плюс нужно было оставить, а остальные удалить, что бы получилось (1+2). Аналогично с нулями, точками, и другими символами.</p>

        <p>Пришлось ещё так же реализовать проверку уже отформатированного ввода. Пришлось повозиться с реализацией шаблона. Это нужно было что бы в консоль не выдавались ошибки которые выбрасывал блок с "подсказками", это предварительный результат вычислений. Пришлось строго проверять строку на соответствие с начала и конца строки - <span class="code-fragment">^....$</span>.</p>
        
        <hr>

        <h1>Обновление 1.0</h1>
        <ul style="margin-bottom: 30px;">
            <li>Проверка ввода. Проверка уже введённого</li>
            <li>Предварительный просмотр результата</li>
            <li>Возможность не прирывать вычисление нажимая на математические операторы</li>
            <li>После нажатия кнопки (=), обновляется ввод</li>
        </ul>

        <h2>Описание 1.0</h2>
        <p>Наступил момент испытать себя, который долго не наступал. Несколько лет назад Я пытался сделать калькулятор, но когда очередь дошла до обработки строки, то как бы - всё, привет. И знаниями необходимыми не обладал. В те давно минувшие дни меня отпугнуло осознание что без регулярок тут не обойтись. Ведь вводимые данные нужно как то обрабатывать. Досадно на днях было узнать, что большинство авторов калькуляторов на ютабе на эти моменты кладут болт и обходятся 10ю строками кода.</p>
        <p>Я задолбался править баги. Вот код работает-работает. Нет! за минусом печатается плюс. Или после первой группы чисел с оператором вычисления, что-то не печатается, что приводит к отвалу кода. То могут два нуля напечататься, что нельзя. То несколько точек в одном числе. Сложнее всего всё отладить было в выражении уже после оператора вычисления. Когда 90% выражения работает отлично, но под конец всё рушится. Хорошо помогал онлайн ресурс визуализирущий результат, который подсвечивал цифры в проблемных строках. Ещё весело в самом начале было, если заметить, то в коде нет флагов после описания выражения джва-скриптовых, типа (gi) и т.д. Да, флаги вызывали баги! "Кто бы мог подумать?!". При тесте строки с флагом (g),результат прыгал туда-сюда показывая true/false по очереди. Как выяснили на форуме, это особенность языка такая.</p>
        <p>После того Я спустя полтора суток... Полтора суток почти за один присест, с перерывом на небольшой сон, всё таки вымучал, кровью и потом эту злосчастную полно-рабочую формулу. Пришло время её теперь себе объяснить. Следует уточнить, что объяснять будет человек с полуторосуточным опытом написания регулярок. Мда... Регулярки мне всегда казались чем-то недостижимым. Помог с ними разобраться один вводный курс по PHP на codeacademy, одной из тем которого были регулярки. Вот они там офигенно объяснялись, с тренажёрами.</p>
        <span class="code-fragment">/^((((\-?0\.\d*)|(\-?[1-9]+\.?\d*)|0|(\-\d))([\+\-\*\/]((\-?0\.\d*)|(\-?[1-9]+\.?\d*)|0)?)?)|\-)$/</span>
        <p>Значит двигаться будем группами. Первый фрагмент.</p>
        <br>
        <span class="code-fragment">^((((\-?0\.\d*)|(\-?[1-9]+\.?\d*)|0|(\-\d)?)</span>
        <p>( ^ ) - ищем совпадения в строке которая начинается с...</p>
        <span class="code-fragment">(\-?0\.\d*)</span>
        <p>( \ ) - экран для минуса. Далее минус. ( ? ) - минус может быть, может не быть. За тем 0. За нулём должна быть точка ( \. - экран для точки). После точки - цифровой символ (\d), * - Повторённый 0 или больше раз.</p>
        <p>( | ) - или.</p>
        <span class="code-fragment">|(\-?[1-9]+\.?\d*)</span>
        <p>( | ) - Или строка может начинаться с группы ( () ). Необязательный минус (\-?).</p>
        <p>( [] ) - Набор знаков. За тем набор цифр от 1 до 9 [1-9], повторяющиеся 1 или более раз (+), далее не обязательная точка (\.?), далее цифра (\d), повторяющаяся 0 или более раз.</p>
        <span class="code-fragment">|0|(\-\d)?</span>
        <p>( | ) - Или строка может начинаться с одиночного нуля. |(\-\d) - Или строка может начинаться с одиночного минуса за которым должна быть цыфра.</p>
        <p>Так описывается число до оператора (+ - * /). Пример: "2.233" до (+1.11). 2.233+1.11. Число у которого может быть минус в начале.</p>
        <br>
        <span class="code-fragment">([\+\-\*\/]((\-?0\.\d*)|(\-?[1-9]+\.?\d*)|0)?)?)|\-)$</span>
        <p>Далее идёт группа в которой должен быть оператор (+ - * /), но которая не обязательна. Знак вопрос в конце которой ( ...)?...)|\-)$ ) указывает на то что этой группы символов может не быть. Т.е. Может быть обычное число. Пример: просто 120.</p>
        <p>Далее следует объеденяющая закрывающая скобка и утверждение ИЛИ ( | ) после которого следует знак МИНУС. Т.е. МИНУС может встретиться ЕДИНАЖДЫ в строке. В основном это нужно для начала ввода отрицательного числа ( - ... 2 ). В конце указан знак ($) - это конец искомой строки. Это значит, что все не соответсвия будут отброшены.</p>
        <span class="code-fragment">([\+\-\*\/]</span>
        <p>Группа начинается с перечисления допустымих операторов после первой группы цифр, [] - набор. Это экранированные (+ - * /),</p>
        <span class="code-fragment">((\-?0\.\d*)|(\-?[1-9]+\.?\d*)|0)?</span>
        <p>Далее в принципе повторяется самое первое выражение из начала регулярного выражения, описывающее - какая допустима цифра после знака "сложения", например.</p>
        <span class="code-fragment">(\-?0\.\d*)</span>
        <p>После оператора "сложения", например, может идти - НОЛЬ с точкой и цифрой после себя, у которого может быть знак минус в начале.</p>
        <span class="code-fragment">|(\-?[1-9]+\.?\d*)</span>
        <p>ИЛИ ( | ) может быть набор ( [] ) цифр от 1 до 9 (1-9), в колличестве 1 и более (+). Потом не обязательная (?) точка (\.?), после которой должна быть цифра (\d), встречающаяся 0 или более раз (*).</p>
        <span class="code-fragment">|0)?</span>
        <p>( |0 ) ИЛИ одиночный ноль, идущий после первой группы цифр с оператором вычисления (2.3333+ наш НОЛЬ).</p>
        <p>( )? ) - После закрывающей скобки идёт утверждение что - этой группы (+ - * / 0.1111) может НЕ БЫТЬ. ( ? ) - 0 или 1 раз.</p>

        <br>

        <p>Кроме шуток. Тут серьёзно. Сейчас меня посетило чувство дежавю. Как будто я уже сидел тут, писал код, заканчивал, так же писав пояснительный текст. В такой же обстановке, и такой же цветовой темой кодового редактора. Это правда было очень давно. Лет так 5 или 7 назад. Почему-то это отпечаталось в памяти и сейчас возникло. (Сегодня 27 сентября 2022). Вот так чертовщина!</p>

        <div class="backward-wrap backward-wrap_margins backward-wrap_txt-right">
            <a class="backward-btn" href="index.html" style="display: inline-block;">Назад</a>
        </div>
    </div>

    <script src="js/jquery-3.5.1.min.js"></script>
    <!-- scripty -->
    <script src="js/main.js"></script>
</body>
</html>